#!/usr/bin/env node

// build-env.js - Gera config-loader.js com vari√°veis de ambiente sincronamente
const fs = require('fs');
const path = require('path');

// Na Vercel, as vari√°veis est√£o prefixadas com NEXT_PUBLIC_
const supabaseUrl = process.env.NEXT_PUBLIC_VITE_SUPABASE_URL || process.env.VITE_SUPABASE_URL || '';
const supabaseKey = process.env.NEXT_PUBLIC_VITE_SUPABASE_KEY || process.env.VITE_SUPABASE_KEY || '';

console.log('üîç Buscando vari√°veis de ambiente:');
console.log('  NEXT_PUBLIC_VITE_SUPABASE_URL:', supabaseUrl ? '‚úì' : '‚úó');
console.log('  NEXT_PUBLIC_VITE_SUPABASE_KEY:', supabaseKey ? '‚úì' : '‚úó');

// Gerar config-loader.js - injetar vari√°veis SINCRONAMENTE no window
const loaderContent = `// Auto-generated by build-env.js - Carrega vari√°veis de ambiente sincronamente
window.__ENV__ = window.__ENV__ || {
  VITE_SUPABASE_URL: '${supabaseUrl}',
  VITE_SUPABASE_KEY: '${supabaseKey}'
};
console.log('‚úì Vari√°veis de ambiente carregadas via config-loader');`;

const loaderPath = path.join(__dirname, 'js', 'config-loader.js');
fs.writeFileSync(loaderPath, loaderContent);
console.log('‚úÖ config-loader.js gerado com sucesso');
