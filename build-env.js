#!/usr/bin/env node

// build-env.js - Gera config-loader.js com variÃ¡veis de ambiente sincronamente
const fs = require('fs');
const path = require('path');

// Verificar TODAS as variÃ¡veis disponÃ­veis
console.log('ðŸ” Todas as variÃ¡veis com VITE ou SUPABASE:');
Object.keys(process.env)
  .filter(key => key.includes('VITE') || key.includes('SUPABASE'))
  .forEach(key => console.log(`  ${key}: ${process.env[key] ? 'âœ“' : 'âœ—'}`));

// Na Vercel, as variÃ¡veis estÃ£o prefixadas com NEXT_PUBLIC_
const supabaseUrl = process.env.NEXT_PUBLIC_VITE_SUPABASE_URL || 
                     process.env.VITE_SUPABASE_URL || 
                     process.env.SUPABASE_URL ||
                     '';

const supabaseKey = process.env.NEXT_PUBLIC_VITE_SUPABASE_KEY || 
                    process.env.VITE_SUPABASE_KEY || 
                    process.env.SUPABASE_KEY ||
                    '';

console.log('\nðŸ“¦ VariÃ¡veis encontradas:');
console.log('  VITE_SUPABASE_URL:', supabaseUrl ? 'âœ“ ' + supabaseUrl.substring(0, 30) + '...' : 'âœ—');
console.log('  VITE_SUPABASE_KEY:', supabaseKey ? 'âœ“ ' + supabaseKey.substring(0, 30) + '...' : 'âœ—');

// Gerar config-loader.js - injetar variÃ¡veis SINCRONAMENTE no window
const loaderContent = `// Auto-generated by build-env.js
window.__ENV__ = window.__ENV__ || {
  VITE_SUPABASE_URL: '${supabaseUrl}',
  VITE_SUPABASE_KEY: '${supabaseKey}'
};
console.log('âœ“ Config carregado', window.__ENV__);`;

const loaderPath = path.join(__dirname, 'js', 'config-loader.js');
fs.writeFileSync(loaderPath, loaderContent);
console.log('\nâœ… config-loader.js gerado com sucesso');
